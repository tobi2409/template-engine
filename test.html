<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div id="app">
        <div>Hallo <span>--</span> {{ name }}

            <div>Du bist {{ name }} und {{ age }} Jahre alt</div>
        </div>

        <if test="showSecondHallo">
            Bedingtes Hallo {{ name }}
            <p>Zweites Element innerhalb der Bedingung</p>

            <if test="nestedCondition">
                <p>Nested Condition ist erreicht, {{ name }}</p>
            </if>
        </if>

        <if test="secondCondition">
            <p>Zweite Condition, {{ name }}</p>
        </if>

        <div>
            <p>Counter: {{ counter }}</p>
        </div>

        <ul>
            <each of="friends" as="f">
                <li>{{ f.name }} ist {{ f.age }} Jahre alt

                    <if test="{{ showChilds }}">
                        <ul>
                            <each of="f.childs" as="c">
                                <li>{{ c.name }}

                                    <if test="{{ showChilds2 }}">

                                        <ul>
                                            <each of="c.childs" as="d">
                                                <li>{{ d }}</li>
                                            </each>
                                        </ul>

                                    </if>

                                </li>
                            </each>
                        </ul>
                    </if>

                </li>
            </each>
        </ul>

        <each of="friends" as="f">
            <p>{{ f.name }}</p>

            <div>
                <if test="showChilds">
                    <each of="f.childs" as="c">
                        <p>--- {{ c.name }}</p>
                    </each>
                </if>
            </div>
        </each>
    </div>

    <script type="module">
        import TemplateEngine from './template-engine.js'

        const data = TemplateEngine.reactive({
            name: 'Tobias',
            age: 31,
            counter: 1,
            showSecondHallo: true,
            nestedCondition: true,
            secondCondition: false,
            friends: [{
                name: 'Freund1',
                childs: [{
                    name: 'Freund1_1',
                    childs: ['Freund1_1_1', 'Freund1_1_2']
                }, {
                    name: 'Freund1_2',
                    childs: ['Freund1_2_1']
                }],
                age: 23
            }, {
                name: 'Freund2',
                childs: [{
                    name: 'Freund2_1',
                    childs: ['Freund2_1_1', 'Freund2_1_2']
                }],
                age: 25
            }],
            showChilds: false,
            showChilds2: true
        }, document.getElementById('app'))

        //render(data, document.getElementById('app'))

        data.showChilds = true
        data.showChilds = true
        data.showChilds = false
        data.showChilds2 = false
        data.counter = 2
        data.nestedCondition = false
        data.friends[0].name = 'Tobias'
        data.friends.push({ name: 'Freund3', childs: [{ name: 'Freund3_1', childs: [] }, { name: 'Freund3_2', childs: [] }], age: 27 }) // friends.push -> key: friends
        data.friends[1].childs.push({ name: 'Freund2_2', childs: [] })
        data.friends[1].childs[0].childs.push('Freund2_1_3')
        /*let changes = [{ key: 'counter', action: 'update' }, { key: 'nestedCondition', action: 'update' },
                        { key: 'friends.0.name', action: 'update' }, { key: 'friends', action: 'createItem' },
                        { key: 'friends.1.childs', action: 'createItem' }, { key: 'friends.1.childs.0.childs', action: 'createItem' }]
        refresh(data, changes)*/

        data.friends[1].childs.push({ name: 'Freund2_3', childs: ['Freund2_3_1', 'Freund2_3_2'] }, { name: 'Freund2_4', childs: [] })
        /*changes = [{ key: 'friends.1.childs', action: 'createItem' }]
        refresh(data, changes)*/

        delete data.friends[1].childs[0]
        /*changes = [{ key: 'friends.1.childs.0', action: 'delete' }]
        refresh(data, changes)*/

        delete data.name
        /*changes = [{ key: 'name', action: 'delete' }]
        refresh(data, changes)*/

        delete data.showSecondHallo
        /*changes = [{ key: 'showSecondHallo', action: 'delete' }]
        refresh(data, changes)*/

        data.friends[1].childs = [{ name: 'Test2_1', age: 30, childs: ['Test2_1_1', 'Test2_1_2'] }, { name: 'Test2_2', age: 25, childs: [] }]
        //data.friends[1].childs = data.friends[1].childs.slice(1, 3)

        //data.friends[1] = { name: 'Test1', age: 20, childs: [{ name: 'Test1_1', childs: [] }, { name: 'Test1_2', childs: [] }] }
        /*changes = [{ key: 'friends.1', action: 'update' }] //TODO*/
    </script>

</body>

</html>