<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div id="app"></div>

    <template id="app-template">
        <h1>Hello World</h1>

        <p>First Name: <get>model.firstName</get></p>
        <p>Last Name: <get>model.lastName</get></p>
        <p><b>Full Name: <get>fullName</get></b></p>

        <input type="text" bind-input-value="model.firstName" placeholder="First Name ..."/>
        <input type="text" bind-input-value="model.lastName" placeholder="Last Name ..."/>

        <br/><br/>

        <div>
            <if test="showWage">
                <p>ðŸ’µ Wage: $<get>model.wage</get></p>
                <p><b><get>fullInfo</get></b></p>
            </if>

            <input type="number" bind-input-value="model.wage" placeholder="Wage ..."/>
        </div>

        <h2>Person Data</h2>

        <ul>
            <each of="beautifiedPersonData" as="personInfo">
                <li attr-item-index="personInfo.id">
                    <get>personInfo.name</get> (<get>personInfo.age</get> years old)
                </li>
            </each>
        </ul>
    </template>

    <template-use id="app-template-use" template-id="app-template" mount-id="app"></template-use>
    
    <script type="module">
        import TemplateEngine from '../src/template-engine.js'

        const model = {
            firstName: 'Alex',
            lastName: 'Gonzales',
            wage: 800,
            rawPersonData: [{ id: 1, name: 'Test', birthyear: 1995 }, { id: 2, name: 'Demo', birthyear: 1990 }]
        }

        const viewModel = TemplateEngine.reactive({
            model: model,
            
            get fullName() {
                return `${model.firstName} ${model.lastName}`
            },

            get showWage() {
                return model.wage > 600
            },

            get fullInfo() {
                return `${this.fullName} earns $${model.wage}`
            },

            get beautifiedPersonData() {
                return model.rawPersonData.map(p => {
                    const age = new Date().getFullYear() - p.birthyear
                    return { id: p.id, name: p.name, age: age, showEdit: true }
                })
            }
        }, document.getElementById('app-template-use'), {
            'model.firstName': ['fullName', 'fullInfo'],
            'model.lastName': ['fullName', 'fullInfo'],
            'model.wage': ['showWage'],
            'model.rawPersonData': ['beautifiedPersonData']
            /*'model.rawPersonData.0.name': ['beautifiedPersonData.0.name']*/
            /*'fullName': ['fullInfo']*/
        })

        viewModel.model.firstName = 'Emily'
        viewModel.model.wage = 200
        viewModel.model.rawPersonData.push({ id: 3, name: 'Sample', birthyear: 1985 })
        viewModel.model.rawPersonData[0].name = 'Test Updated'
        viewModel.model.rawPersonData.splice(1, 1)
    </script>

</body>
</html>