<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <div id="app"></div>

    <template id="app-template">
        <h1>Todo-Liste</h1>

        <ul>
            <each of="todos" as="todo">
                <li attr-item-id="todo.id">
                    <get>todo.name</get>

                    <!--<if test="todo.showEdit">-->
                        <input type="text" bind-input-value="todo.name" />
                        <!--<button class="save-button">Speichern</button>
                    </if>-->

                    <button class="edit-button">Bearbeiten</button>
                </li>
            </each>
        </ul>

        <input id="new-todo-input" type="text" placeholder="Neues Todo" bind-input-value="newTodo" />
        <button id="add-todo-btn">Hinzuf√ºgen</button>
    </template>

    <template-use id="app-template-use" template-id="app-template" mount-id="app"></template-use>

    <script type="module">

        import TemplateEngine from '../src/template-engine.js'

        const data = TemplateEngine.reactive({
            todos: [],
            newTodo: ''
        }, document.getElementById('app-template-use'))

        const addTodoBtn = document.getElementById('add-todo-btn')

        addTodoBtn.addEventListener('click', () => {
            data.todos.push({ id: data.todos.length + 1, name: data.newTodo, showEdit: true })
            data.newTodo = ''
        })

        // Event Delegation: Listener auf dem Parent-Element
        document.getElementById('app').addEventListener('click', (event) => {
            const itemId = event.target.parentElement.getAttribute('item-id')
            const todo = data.todos.find(t => t.id == itemId)
            
            if (!todo) return
            
            // Edit button clicked
            if (event.target.classList.contains('edit-button')) {
                todo.showEdit = !todo.showEdit
            }
            
            // Save button clicked (thanks to bind-input-value, todo.name is already updated!)
            if (event.target.classList.contains('save-button')) {
                todo.showEdit = false
            }
        })

        data.newTodo = 'Mein erstes Todo'

    </script>

</body>
</html>