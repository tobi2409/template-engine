<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model-ViewModel Example - Template Engine</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .status.loading { background: #fff3cd; }
        .status.success { background: #d4edda; }
        .status.error { background: #f8d7da; }
        
        input[type="text"] {
            padding: 8px;
            width: 300px;
            margin-right: 10px;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        li.completed {
            background: #f0f0f0;
            text-decoration: line-through;
        }
        .todo-text {
            flex: 1;
        }
    </style>
</head>
<body>
    
    <div id="app"></div>

    <template id="app-template">
        <h1>üìù Todo List (Model-ViewModel Architecture)</h1>

        <p><strong>Statistics:</strong> <get>totalCount</get> total, <get>completedCount</get> completed, <get>activeCount</get> active</p>

        <div>
            <label for="new-todo-input">New task:</label>
            <input id="new-todo-input" type="text" bind-input-value="newTodoText" placeholder="What needs to be done?" />
            <button action-click="addTodo">‚ûï Add</button>
        </div>

        <h2>Tasks</h2>
        <ul>
            <each of="todos" as="todo">
                <li attr-class="todo.completed ? 'completed' : ''">
                    <input type="checkbox" bind-input-checked="todo.completed" action-change="toggleTodo" attr-data-id="todo.id" />
                    <span class="todo-text"><get>todo.text</get></span>
                    <small>(<get>todo.id</get>)</small>
                    <button action-click="deleteTodo" attr-data-id="todo.id">üóëÔ∏è</button>
                </li>
            </each>
        </ul>
    </template>

    <template-use id="app-template-use" template-id="app-template" mount-id="app"></template-use>

    <script type="module">
        import TemplateEngine from '../../../src/template-engine.js'
        import { fakeBackend } from './fake-backend.js'

        const model = {
            fetchTodos() {
                return fakeBackend.getTodos()
            },

            createTodo(text) {
                return fakeBackend.createTodo({ text })
            },

            updateTodo(id, updates) {
                return fakeBackend.updateTodo(id, updates)
            },

            deleteTodo(id) {
                return fakeBackend.deleteTodo(id)
            }
        }

        const viewModel = TemplateEngine.reactive({
            todos: [],
            newTodoText: '',
            
            // Computed properties (automatically calculated)
            get totalCount() {
                return this.todos.length
            },
            
            get completedCount() {
                return this.todos.filter(t => t.completed).length
            },
            
            get activeCount() {
                return this.todos.filter(t => !t.completed).length
            },
            
            // Actions: User Interactions
            fetchTodos() {
                viewModel.todos = model.fetchTodos()
            },

            addTodo() {
                if (viewModel.newTodoText.trim()) {
                    const newTodo = model.createTodo(viewModel.newTodoText)
                    viewModel.todos.push(newTodo)
                    viewModel.newTodoText = ''
                }
            },
            
            toggleTodo(e) {
                const id = parseInt(e.target.getAttribute('data-id'))
                const todo = this.todos.find(t => t.id === id)
                if (todo) {
                    const updatedTodo = model.updateTodo(id, { completed: !todo.completed })
                    Object.assign(todo, updatedTodo)
                }
            },
            
            deleteTodo(e) {
                const id = parseInt(e.target.getAttribute('data-id'))
                if (confirm('Delete this todo?')) {
                    model.deleteTodo(id)
                    const index = this.todos.findIndex(t => t.id === id)
                    if (index !== -1) {
                        this.todos.splice(index, 1)
                    }
                }
            }
        }, document.getElementById('app-template-use'))

        // Initial data load
        viewModel.fetchTodos()

        console.log('Model-ViewModel architecture initialized')
        console.log('Model:', model)
        console.log('ViewModel:', viewModel)
    </script>

</body>
</html>
